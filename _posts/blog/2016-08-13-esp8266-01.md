---
layout: page
title: "Mise en route d’un ESP8266-01"
modified:
categories:
excerpt:
tags: []
image:
     feature:
date: 2016-08-13T09:23:00+02:00
published: true
author: Nico
---


> L’ESP-01 présenté ici, m’a été transmis par [Didel][0]. Donc merci à Jean-Daniel Nicoud.


![ESP8266-01](/files/2016-08-13-esp8266-01/esp8266-01.jpg)

![ESP8266-01 brochage](/files/2016-08-13-esp8266-01/esp8266-01_pinout.jpg)

# L’ESP8266-01

L’ESP8266-01 est un SoC (*System on Chip*) qui contient un microcontrôleur et un système WiFi. Il est également pourvu d’un port RS232 qu’on peut utiliser pour lui envoyer des commandes AT. Il peut donc être utilisé de deux façons différentes (au moins) :

- En lui envoyant des commandes AT sur son port RS232 avec un ordinateur ou un microcontrôleur.
- En programmant directement son microcontrôleur interne.

Sur le web, on trouve surtout des tutos qui décrivent la solution utilisant les commandes AT. À mon avis c’est du gâchis, car ces commandes ne donnent accès qu’à une petite partie des fonctionnalités de ce SoC. Cependant, elles peuvent être utiles pour des premiers tests. En particulier, elles permettent de déterminer la vitesse de transmission du port RS232, car suivant la version du module, elle peut être de 9600 bauds ou de 115200 bauds.

> Les commandes AT peuvent vite être très limitantes car il faudra prévoir toutes les réponses possibles et le programme deviendra donc vite très complexe. En plus ces commandes ont évolué avec les versions des firmwares. Donc la compatibilité n’est pas assurée.


# Programmation avec des commandes AT

L’idée est d’utiliser un ordi avec [CoolTerm][1] pour envoyer quelques commandes AT à l’ESP-01. Comme je n’ai pas de bridge USB-RS232, j’utilise un ESP-12E sur lequel j’ai connecté la broche RST au GND pour que l’ESP-12E ne démarre pas. Ainsi les commandes envoyées de l’ordi se retrouvent directement sur les broches TX et RX de l’ESP-12E. Ce montage peut être schématiquement représenté de la façon suivante :

````
ordi TX -------   - ESP8266-12E TX ------- ESP8266-01 TX
               \/
               /\
ordi RX -------   - ESP8266-12E RX ------- ESP8266-01 RX
````

On voit que le TX de l’ESP-12E doit être connecté au TX de l’ESP-01 et inversement pour le RX.

**Il est important de comprendre que l’ESP-12E est utilisé comme un bridge USB-RS232 et pas pour ses fonctionnalités WiFi.** J’aurais pu utiliser un Arduino, mais je n’ai que des modules 5 V. Donc j’ai préféré l’ESP-12E qui lui fonctionne en 3.3 V.

## Câblage de l’ESP-01

- Il est nécessaire d’utiliser une alimentation 3.3 V externe, car l’ESP-01 peut être très gourmant (~300 mA), particulièrement lorsque le WiFi se met en route.
- La broche CH_PD (*chip power-down*) doit être obligatoirement mise à VCC pour que le module soit actif.
- Optionnellement, on peut aussi mettre RST à VCC pour s’assurer qu’il n’y a pas de *reset* intempestifs.

## Câblage de l’ESP-12E<br/>(utilisé comme bridge USB-RS232)

- Mettre RST à GND pour que l’ESP-12E ne démarre pas.
- Connecter TX au TX de l’ESP-01
- Connecter RX au RX de l’ESP-01

## Câblage sur breadboard

Note : Les LED rouge et verte ne sont pas connectées.

![ESP8266-01 brochage](/files/2016-08-13-esp8266-01/esp8266-01_montage_commandes_AT_lowres.jpg)

## Utilisation de CoolTerm

Dans les options de CoolTerm, choisir une vitesse de transmission (9600 ou 115200 bauds). Si les commandes ci-dessous ne passent pas, modifier la vitesse. Dans mon cas, ça marche à 115200 bauds.

[Sparkfun a un PDF avec toutes les commandes AT possibles.][2]

La première commande à tester est

    AT

Et l’ESP doit répondre

    OK

Ensuite on peut envoyer un *reset*

    AT+RST

et l’ESP répond

![ESP8266-01 réponse commande AT+RST](/files/2016-08-13-esp8266-01/coolterm-esp01_1.png)

Pour continuer avec les commandes AT, lire les pages suivantes :

- [alselectro — WiFi Module ESP8266 – 1. Getting started with AT commands][3]
- [alselectro — WiFi Module ESP8266 – 2. TCP CLIENT /Server mode][4]

[J’ai compilé les informations de ces deux pages télégraphiquement](/files/2016-08-13-esp8266-01/esp_commandes_at_utiles.md)

Il y a également des informations intéressantes sur ces pages :

- [Nicolas C. Blog — ESP8266 première partie : Généralités][5]
- [Nicolas C. Blog — ESP8266 seconde partie : Le mode Standalone][6]

<!--

{% highlight C++ %}

{% endhighlight %}

-->

[0]: http://didel.com/
[1]: http://freeware.the-meiers.org/
[2]: https://cdn.sparkfun.com/assets/learn_tutorials/4/0/3/4A-ESP8266__AT_Instruction_Set__EN_v0.30.pdf
[3]: https://alselectro.wordpress.com/2015/05/05/wifi-module-esp8266-1-getting-started-with-at-commands/
[4]: https://alselectro.wordpress.com/2015/05/13/wifi-module-esp8266-2-tcp-client-server-mode/
[5]: http://blog.nicolasc.eu/esp8266-premiere-partie-generalites/
[6]: http://blog.nicolasc.eu/esp8266-seconde-partie-le-mode-standalone/
