<!DOCTYPE html>
<html lang="en">

<!--
    "THE BEER-WARE LICENSE" (Revision 42):
    I wrote this file. You can do what you want with this stuff.
    If we meet some day, and you think this is worth it,
    you can buy me a beer in return.

    Nicolas Jeanmonod
    ouilogique.com
 -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CENTERED POLYGONAL NUMBER GENERATOR</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGlkPSJjZW50ZXJlZF9wb2x5Z29uYWxfbnVtYmVyX3N2ZyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSItMTEuMCAtMTEuMCAyMiAyMiIKICAgIHdpZHRoPSI4MDBweCIgaGVpZ2h0PSI4MDBweCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMCk7Ij4KCiAgICA8dGl0bGU+Q2VudGVyZWQgcG9seWdvbmFsIG51bWJlcjwvdGl0bGU+CiAgICA8ZGVzYz5DZW50ZXJlZCBwb2x5Z29uYWwgbnVtYmVyPC9kZXNjPgoKICAgIDxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CiAgICAgICAgY2lyY2xlLAogICAgICAgIHBhdGggewogICAgICAgICAgICBmaWxsOiBub25lOwogICAgICAgICAgICBzdHJva2Utd2lkdGg6IDAuNTsKICAgICAgICAgICAgc3Ryb2tlOiAjMDAwOwogICAgICAgIH0KCiAgICAgICAgLmwxIHsKICAgICAgICAgICAgZmlsbDogaHNsKDAsIDgwJSwgODAlKTsKICAgICAgICAgICAgc3Ryb2tlOiBoc2woMCwgODAlLCA3MCUpOwogICAgICAgIH0KCiAgICAgICAgLmwwIHsKICAgICAgICAgICAgZmlsbDogaHNsKDE1MCwgNjUlLCA2NyUpOwogICAgICAgICAgICBzdHJva2U6IGhzbCgxNTAsIDY1JSwgNTclKTsKICAgICAgICB9CgogICAgICAgIEBtZWRpYShwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewogICAgICAgICAgICAubDAgewogICAgICAgICAgICAgICAgZmlsbDogaHNsKDAsIDgwJSwgODAlKTsKICAgICAgICAgICAgICAgIHN0cm9rZTogaHNsKDAsIDgwJSwgNzAlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmwxIHsKICAgICAgICAgICAgICAgIGZpbGw6IGhzbCgxNTAsIDY1JSwgNjclKTsKICAgICAgICAgICAgICAgIHN0cm9rZTogaHNsKDE1MCwgNjUlLCA1NyUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgPC9zdHlsZT4KCiAgICA8ZyBpZD0ic3ZnX2NvbnRhaW5lciI+CiAgICAgICAgPGNpcmNsZSBjbGFzcz0ibDAiIHI9IjIuNiIgY3g9IjAuMDAwIiBjeT0iMC4wMDAiIC8+CiAgICAgICAgPGNpcmNsZSBjbGFzcz0ibDEiIHI9IjIuNiIgY3g9IjguMjUwIiBjeT0iMC4wMDAiIC8+CiAgICAgICAgPGNpcmNsZSBjbGFzcz0ibDEiIHI9IjIuNiIgY3g9IjQuMTI1IiBjeT0iLTcuMTQ0IiAvPgogICAgICAgIDxjaXJjbGUgY2xhc3M9ImwxIiByPSIyLjYiIGN4PSItNC4xMjUiIGN5PSItNy4xNDQiIC8+CiAgICAgICAgPGNpcmNsZSBjbGFzcz0ibDEiIHI9IjIuNiIgY3g9Ii04LjI1MCIgY3k9Ii0wLjAwMCIgLz4KICAgICAgICA8Y2lyY2xlIGNsYXNzPSJsMSIgcj0iMi42IiBjeD0iLTQuMTI1IiBjeT0iNy4xNDQiIC8+CiAgICAgICAgPGNpcmNsZSBjbGFzcz0ibDEiIHI9IjIuNiIgY3g9IjQuMTI1IiBjeT0iNy4xNDQiIC8+CiAgICA8L2c+CgoKPC9zdmc+">

    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            background-color: rgba(255, 255, 255, 0);
            font-family: monospace;
            margin: 0;
            padding: 0;
        }
        h1 {
            text-transform: uppercase;
        }
        svg {
            height: 100%;
            left: 0;
            margin: 0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: -1;
        }
        label {
            display: inline-block;
            margin: 0 10px 0 0;
            text-align: right;
            width: 170px;
        }
        input {
            width: 300px;
        }
        .header, .controls {
            background-color: rgba(255, 255, 255, 0.7);
        }
        .footer {
            align-items: center;
            background-color: rgba(200, 200, 200, 0);
            bottom: 0;
            display: absolute;
            margin: 0;
            position: fixed;
            width: 100%;
        }
        .controls {
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 20px 20px 0 0;
            margin: 0 auto;
            max-width:700px;
            min-width:200px;
            padding: 20px 0px 10px;
            display: flex;
            align-items: center;
            flex-direction: column;
        }
        .controls p {
            text-align: center;
            margin: 20px auto 4px;
        }
        .control {
            display: block;
            margin: 0 auto;
        }
        .control input {
            max-width:160px;
            min-width:10px;
            display: inline-block;
        }
        .control label {
            bottom:4px;
            display: inline-block;
            margin: 0 4px 0 0;
            max-width:150px;
            min-width:10px;
            padding: 0;
            position: relative;
        }
        .header {
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 0 0 20px 20px;
            margin: 0 auto;
            margin: 0 auto;
            max-width:700px;
            min-width:200px;
            padding: 20px;
            position: sticky;
            text-align: center;
            top: 0;
        }
        kbd {
            border-radius: 10%;
            border: 1px solid #AAA;
            display: inline-block;
            font-size: 0.9em;
            margin: 0;
            min-width: 40px;
            padding: 0 3px !important;
            text-align: center;
        }
    </style>
</head>

<body>

    <div class="header">
        <h1>Centered polygonal number generator</h1>
        <p><a tabindex="-1" target="_blank" href="https://en.wikipedia.org/wiki/Centered_polygonal_number">https://en.wikipedia.org/wiki/Centered_polygonal_number</a></p>
        <p><a tabindex="-1" target="_blank" href="https://stackoverflow.com/q/77922222/3057377">https://stackoverflow.com/q/77922222/3057377</a></p>
    </div>

    <svg
        id = "centered_polygonal_number_svg"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        shape-rendering="crispEdges"
        viewBox="-40 -40 80 80">
    <!--
        Use this viewBox if the SVG is standaloneÂ :
        viewBox="-20 -20 40 40"
    -->

    <!--
        Idea from:
        https://stackoverflow.com/q/77922222/3057377

        See also:
        https://en.wikipedia.org/wiki/Centered_polygonal_number
    -->

    <!--
        "THE BEER-WARE LICENSE" (Revision 42):
        I wrote this file. You can do what you want with this stuff.
        If we meet some day, and you think this is worth it,
        you can buy me a beer in return.

        Nicolas Jeanmonod
        ouilogique.com
    -->


        <title>Centered polygonal number</title>
        <desc>Centered polygonal number</desc>


        <style>
            /*
            Style can be applied to individual dots by targeting their IDs.
            For instance, the 10th dot can be accessed as follows:
            #c10 { fill: red; }

            If you want to display the IDs themselves, comment the `display none` statement below.

            Style can also be applied to the dots within a specific layer by targeting their class.
            For instance, the dots on the 2nd layer can be accessed as follows:
            .l2 { fill: hsl(110, 45%, 75%); stroke: hsl(110, 45%, 65%); }

            The last layer has an extra class called `.llast`.

            Style can also be applied to slices.
            For instance, the slices 1 to 6 can be accessed as follow:
            .s1,.s2,.s3,.s4,.s5,.s6{ fill: hsl(0, 0%, 95%); stroke: hsl(0, 0%, 85%); }
            */
            svg { background-color: rgba(255, 255, 255, 0); }
            text { text-anchor: middle; font-size: 4px; font-family: monospace; fill: hsl(0, 0%, 30%); z-index: 1000; dominant-baseline: middle; text-shadow: #FFF 0 0 20px; }
            text.dottext {
                fill: hsl(0, 0%, 0%);
                font-size: 1px;
                stroke: none;
            }
            circle { fill: hsl(0, 0%, 30%); stroke: hsl(0, 0%, 70%); stroke-width: 0.2; opacity: 0.6; }
            .l0 { fill: hsl(0, 80%, 80%); stroke: hsl(0, 80%, 70%); }
            .l1 { fill: hsl(150, 65%, 67%); stroke: hsl(150, 65%, 57%); }
            .l2 { fill: hsl(110, 45%, 75%); stroke: hsl(110, 45%, 65%); }
            .l3 { fill: hsl(255, 50%, 80%); stroke: hsl(255, 50%, 70%); }
            .l4 { fill: hsl(120, 30%, 48%); stroke: hsl(120, 30%, 38%); }
            .llast { fill: hsl(90, 100%, 50%); stroke: hsl(90, 100%, 40%); }
            /*
            .s1,.s2,.s3,.s4,.s5,.s6{ fill: hsl(0, 0%, 95%); stroke: hsl(0, 0%, 85%); }
            */

            @media print {
                @page {
                    size: 40mm 40mm;
                    margin: 0;
                    padding: 0;
                }
            }
        </style>

        <g id="svg_container"></g>

        <script type="application/ecmascript">
    <![CDATA[

    "use strict";


    function rotatePoint(_x, _y, angle_rad) {
        const newX = _x * Math.cos(angle_rad) - _y * Math.sin(angle_rad);
        const newY = _x * Math.sin(angle_rad) + _y * Math.cos(angle_rad);
        return { x: newX.toFixed(3), y: newY.toFixed(3) };
    }


    /**
    *   Initialization of CPN, the object containing
    *   the data for the centered polygonal number.
    *   When calling the function `centered_polygonal_number`,
    *   the first 4 properties must be provided.
    *   The other properties are then computed.
    */
    let CPN = {
        side_count  : 7,
        layer_count : 5,
        layer_gap   : 3,
        dot_radius  : 1,
        display_ids : false,
        dot_count   : null,
        coords      : [{
            is_last_layer : null,
                    layer : null,
                    side : null,
                    dot : null,
                        x : null,
                        y : null,
        }],
    };


    /**
    * Optional: Override CPN initial values with GET parameters if present.
    * Example URL:
    * centered_polygonal_numbers.svg?side_count=5&layer_count=3&layer_gap=2&dot_radius=0.5
    */
    const urlParams = new URLSearchParams(window.location.search);
    for (const _p of urlParams) {
        if (CPN.hasOwnProperty(_p[0])) {
            CPN[_p[0]] = _p[1];
        };
    }


    /**
    * Draw with initial values.
    */
    centered_polygonal_number(CPN);


    function centered_polygonal_number(cpn) {
        cpn = compute_centered_polygonal_number(cpn);
        drawSVG(cpn);
    }


    function compute_centered_polygonal_number(cpn) {
        cpn.side_count = parseInt(cpn.side_count);
        cpn.layer_count = parseInt(cpn.layer_count);
        cpn.layer_gap = parseFloat(cpn.layer_gap);
        cpn.dot_radius = parseFloat(cpn.dot_radius);

        // Math stuff.
        const angle1_deg = 360 / cpn.side_count;
        const angle1_rad = 2 * Math.PI / cpn.side_count;
        const angle2_rad = (Math.PI - angle1_rad) / 2;
        const dist_dot2_dot3 = 2 * cpn.layer_gap * Math.sin(angle1_rad / 2);
        const dx = -dist_dot2_dot3 * Math.cos(angle2_rad);
        const dy = -dist_dot2_dot3 * Math.sin(angle2_rad); // SVG y sign is opposite to usual carthesian repr.
        cpn.dot_count = cpn.side_count * cpn.layer_count / 2 * (cpn.layer_count - 1) + 1;

        // Calculate rotation offset to ensure that the polygon lies flat on one side.
        const rot_offset_flat =
            (cpn.side_count - 2) % 4 === 0
            ? 0
            : (Math.PI - angle1_rad) / 2;

        // Calculate the coordinates of the dots and some metadata.
        cpn.coords = [];
        for (let _i = 0; _i < cpn.layer_count; _i++) {
            // Iterate by layer:
            // - All layers: Iterate from 0 to cpn.layer_count - 1.
            const is_last_layer = _i == cpn.layer_count - 1;
            const jmax = _i > 0 ? cpn.side_count : 1;
            const kmax = _i > 0 ? _i - 1 : 0;
            for (let _j = 0; _j < jmax; _j++) {
                // Iterate by polygon side:
                // - First layer: Iterate once.
                // - Other layers: Iterate from 0 to to cpn.side_count - 1.
                const angle_rad = -angle1_rad * _j + rot_offset_flat;
                for (let _k = 0; _k <= kmax; _k++) {
                    // Iterate by dot.
                    // - First layer: Iterate once.
                    // - Other layers: Iterate from 0 to to layer_index - 1.
                    const _x = _i * cpn.layer_gap + _k * dx;
                    const _y = _k * dy;
                    const xy = rotatePoint(_x, _y, angle_rad);
                    cpn.coords.push({
                is_last_layer : is_last_layer,
                        layer : _i,
                         side : _j,
                          dot : _k,
                            x : xy.x,
                            y : xy.y,
                    });
                }
            }
        }
        return cpn;
    }


    function drawSVG(cpn) {
        let svg_string = ``;

        // Add the dots and the text on them if CPN.display_ids is true.
        for (let _i = 0; _i < cpn.coords.length; _i++) {
            const layer_class = cpn.coords[_i].is_last_layer
                ? `l${cpn.coords[_i].layer} llast`
                : `l${cpn.coords[_i].layer}`;
            const side_class = `s${cpn.coords[_i].side}`;
            svg_string += `<circle id = "c${_i}"
                                class = "${layer_class} ${side_class}"
                                   cx =  "${cpn.coords[_i].x}"
                                   cy =  "${cpn.coords[_i].y}"
                                    r =  "${cpn.dot_radius}" />\n`
            if (! CPN.display_ids) { continue };
            svg_string +=   `<text id = "t${_i}"
                                class =  "${layer_class} ${side_class} dottext"
                                    x =  "${cpn.coords[_i].x}"
                                    y =  "${cpn.coords[_i].y}"
                                            >${_i}</text>\n`;
        }

        // Add the numerical representation of the Centered Polygonal Number.
        svg_string += `<text id="dot_count" x="0" y="-16">${cpn.dot_count}</text>`;

        // Update display.
        const svg_container = document.getElementById("svg_container")
        svg_container.innerHTML = svg_string;
    }


    ]]>
            </script>

        </svg>

<div class="footer">
    <div class="controls">
        <div class="control"><label for="display_ids"></label><input class="npn" id="display_ids" type="checkbox"></div>
        <div class="control"><label for="side_count" ></label><input class="npn" id="side_count"  type="range" min="3" max="20" step="1"   value="6"></div>
        <div class="control"><label for="layer_count"></label><input class="npn" id="layer_count" type="range" min="1" max="32" step="1"   value="4"></div>
        <div class="control"><label for="layer_gap"  ></label><input class="npn" id="layer_gap"   type="range" min="1" max="10" step="1"   value="3"></div>
        <div class="control"><label for="dot_radius" ></label><input class="npn" id="dot_radius"  type="range" min="0" max= "3" step="0.1" value="1"></div>
        <p>Hint: Press the <kbd>Tab</kbd> key to select the controls<br>and set the values with these keys<br><kbd>â</kbd> <kbd>space</kbd> <kbd>â</kbd></p>
    </div>
</div>

<script>


    document.addEventListener("DOMContentLoaded", function(event) {
        update_CPN_and_label_all();
    });


    function update_CPN_and_label_all() {
        const inputs = document.querySelectorAll("input.npn");
        inputs.forEach(function(input) {
            update_CPN_and_label_single(input);
        });
    }

    function update_CPN_and_label_single(input) {
        // Get the value of the input.
        const val =
        input.type === "checkbox"
        ? input.checked
        : input.value;

        // Update the drawing.
        CPN[input.id] = val;
        centered_polygonal_number(CPN);

        // Update the label.
        const lbl = document.querySelector(`label[for="${input.id}"]`);
        lbl.textContent = `${input.id} = ${val}`;
    }


    side_count.oninput = function() { update_CPN_and_label_single(this); }
    layer_count.oninput = function() { update_CPN_and_label_single(this); }
    layer_gap.oninput = function() { update_CPN_and_label_single(this); }
    dot_radius.oninput = function() { update_CPN_and_label_single(this); }
    display_ids.oninput = function() { update_CPN_and_label_single(this); }


</script>

</body>

</html>
